# dingo-verify: Waveform Verification Tool

This directory contains example configuration files for the `dingo-verify` command-line tool.

## Purpose

The `dingo-verify` tool compares waveforms generated by:
- **dingo-waveform** (refactored package)
- **dingo** (original dingo-gw package)

This verification ensures that the refactored package produces scientifically identical results to the original implementation.

## Installation

After installing dingo-waveform, the `dingo-verify` command is automatically available:

```bash
pip install -e .
```

## Usage

### Basic Usage

```bash
# Use config.json in current directory
dingo-verify

# Specify configuration file
dingo-verify --config config_uniform.json

# Verbose output with detailed comparison
dingo-verify --config config_multibanded.json --verbose
```

### Available Options

```
--config, -c PATH    Path to JSON configuration file (default: config.json)
--verbose, -v        Display detailed comparison output
--seed, -s SEED      Random seed for reproducibility
--modes, -m          Compare mode-separated waveforms (generate_hplus_hcross_m)
```

## Example Configurations

### 1. UniformFrequencyDomain (`config_uniform.json`)

Verifies waveform generation on a uniform frequency grid:
- Frequency range: 20-1024 Hz
- Delta f: 0.125 Hz
- Approximant: IMRPhenomXPHM

```bash
dingo-verify --config examples/config_uniform.json
```

### 2. MultibandedFrequencyDomain (`config_multibanded.json`)

Verifies waveform generation on a multibanded (dyadic) frequency grid:
- Frequency range: 20-1038 Hz
- Nodes: [20.0, 26.0, 34.0, 46.0, 62.0, 78.0, 1038.0]
- Delta f initial: 0.0625 Hz
- Approximant: IMRPhenomXPHM

```bash
dingo-verify --config examples/config_multibanded.json
```

## Configuration File Format

```json
{
  "domain": {
    "type": "UniformFrequencyDomain" or "MultibandedFrequencyDomain",
    // For UniformFrequencyDomain:
    "delta_f": 0.125,
    "f_min": 20.0,
    "f_max": 1024.0

    // For MultibandedFrequencyDomain:
    "nodes": [20.0, 26.0, 34.0, 46.0, 62.0, 78.0, 1038.0],
    "delta_f_initial": 0.0625,
    "base_delta_f": 0.0625
  },
  "waveform_generator": {
    "approximant": "IMRPhenomXPHM",  // Or IMRPhenomD, SEOBNRv5PHM, etc.
    "f_ref": 20.0,
    "f_start": 20.0,
    "spin_conversion_phase": 0.0  // Optional, default: 0.0
  },
  "waveform_parameters": {
    "mass_1": 36.0,                  // Solar masses
    "mass_2": 29.0,                  // Solar masses
    "chirp_mass": 28.095556,         // Derived from masses
    "mass_ratio": 0.805556,          // m2/m1
    "luminosity_distance": 1000.0,   // Mpc
    "theta_jn": 0.5,                 // Inclination angle (radians)
    "phase": 0.0,                    // Coalescence phase
    "a_1": 0.5,                      // Dimensionless spin magnitude
    "a_2": 0.3,
    "tilt_1": 0.5,                   // Spin tilt angles (radians)
    "tilt_2": 0.8,
    "phi_12": 1.7,                   // Azimuthal angles (radians)
    "phi_jl": 0.3,
    "geocent_time": 0.0              // Coalescence time
  }
}
```

## Output Interpretation

### Success (✅)

```
✅ VERIFICATION PASSED
✅ dingo-waveform produces IDENTICAL results to dingo (dingo-gw)
```

Differences are at machine precision level (< 1e-15). The refactored package is working correctly.

### Acceptable (⚠️)

```
⚠️ VERIFICATION ACCEPTABLE
⚠️ Differences are small but above machine precision
```

Small numerical differences that may be acceptable depending on use case. Typically occurs due to different numerical libraries or order of operations.

### Failure (❌)

```
❌ VERIFICATION FAILED
❌ Differences exceed acceptable tolerance
```

Significant discrepancies detected. This indicates a potential bug or incompatibility.

## Supported Approximants

### LAL Approximants (UniformFrequencyDomain)
- IMRPhenomD
- IMRPhenomXAS
- IMRPhenomXPHM
- TaylorF2

### Time-domain Approximants (Both domains)
- SEOBNRv4PHM
- SEOBNRv5PHM
- SEOBNRv5HM

## Creating Custom Configurations

1. Copy one of the example files
2. Modify the parameters:
   - Choose domain type and parameters
   - Select approximant
   - Set physical parameters (masses, spins, etc.)
3. Run verification:

```bash
dingo-verify --config my_config.json
```

## Exit Codes

- `0`: Verification passed (differences < 1e-15)
- `1`: Verification failed (shape mismatch or differences > 1e-10)

## Examples

### Quick verification

```bash
cd examples/
dingo-verify --config config_uniform.json
```

### Detailed analysis

```bash
dingo-verify --config config_multibanded.json --verbose
```

### Reproducible results

```bash
dingo-verify --config config_uniform.json --seed 42
```

## Troubleshooting

### "Configuration file not found"
- Ensure the path to the configuration file is correct
- Use absolute paths or paths relative to current directory

### "Approximant not supported"
- Check that both dingo and dingo-waveform support the approximant
- Verify approximant name spelling

### "Shape mismatch"
- This indicates a fundamental incompatibility
- Check that domain parameters match between packages
- Report as a bug if parameters are valid

## Contact

For issues or questions:
- GitHub: https://github.com/dingo-gw/dingo-waveform
- Report issues: https://github.com/dingo-gw/dingo-waveform/issues
