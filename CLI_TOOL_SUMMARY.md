# dingo-verify: Waveform Verification CLI Tool

## Summary

Created a command-line tool `dingo-verify` that compares waveforms generated by dingo-waveform against the original dingo (dingo-gw) package. This provides users with an easy way to verify that the refactored package produces scientifically identical results.

---

## What Was Done

### 1. Moved Comparison Utilities to Package ✅

**Before:**
- `tests/utils_comparison.py` - Only accessible within tests

**After:**
- `dingo_waveform/comparison.py` - Part of the main package
- Updated imports in `tests/test_mfd_decimation.py`
- Updated imports in `tests/test_dingo_compatibility.py`
- Removed old `tests/utils_comparison.py`

### 2. Created CLI Executable ✅

**File:** `dingo_waveform/cli.py`

Features:
- JSON configuration file support
- Automatic comparison of both packages
- Clear terminal output with visual indicators (✅/❌/⚠️)
- Verbose mode for detailed analysis
- Proper exit codes (0=pass, 1=fail)
- Comprehensive help text and examples

### 3. Registered Entry Point ✅

**File:** `pyproject.toml`

```toml
[project.scripts]
dingo-verify = "dingo_waveform.cli:main"
```

After installation, users can run `dingo-verify` from anywhere.

### 4. Created Example Configurations ✅

**Files:**
- `examples/config_uniform.json` - UniformFrequencyDomain example
- `examples/config_multibanded.json` - MultibandedFrequencyDomain example
- `examples/README.md` - Complete user guide

### 5. Tested Successfully ✅

Both test cases pass:
- **UniformFrequencyDomain**: Exact match (0.00e+00 difference)
- **MultibandedFrequencyDomain**: Machine precision match (1.97e-24 difference)

---

## Usage

### Installation

```bash
cd dingo-waveform
pip install -e .
```

This registers the `dingo-verify` command globally.

### Basic Usage

```bash
# Use config.json in current directory
dingo-verify

# Specify configuration file
dingo-verify --config examples/config_uniform.json

# Verbose output
dingo-verify --config examples/config_multibanded.json --verbose

# Set random seed
dingo-verify --config config.json --seed 42
```

### Configuration File Format

```json
{
  "domain": {
    "type": "UniformFrequencyDomain" | "MultibandedFrequencyDomain",
    // Domain-specific parameters
  },
  "waveform_generator": {
    "approximant": "IMRPhenomXPHM",
    "f_ref": 20.0,
    "f_start": 20.0,
    "spin_conversion_phase": 0.0
  },
  "waveform_parameters": {
    "mass_1": 36.0,
    "mass_2": 29.0,
    // ... other physical parameters
  }
}
```

---

## Output Examples

### Success Case

```
================================================================================
WAVEFORM VERIFICATION RESULTS
================================================================================

Domain Type:         UniformFrequencyDomain
Length:              8193 bins
Frequency Range:     20.00 - 1024.00 Hz

Shape Match:         ✅ YES

Absolute Differences:
  h_plus  max:       0.00e+00
  h_plus  mean:      0.00e+00
  h_cross max:       0.00e+00
  h_cross mean:      0.00e+00

Relative Differences:
  h_plus  max:       0.00e+00
  h_cross max:       0.00e+00

Tolerance:           1.00e-15
Max Difference:      0.00e+00

✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅
✅ VERIFICATION PASSED
✅ dingo-waveform produces IDENTICAL results to dingo (dingo-gw)
✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅

================================================================================
```

### Failure Case

```
❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌
❌ VERIFICATION FAILED
❌ Differences (1.23e-05) exceed acceptable tolerance
❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌
```

---

## Files Created/Modified

### New Files
```
dingo_waveform/comparison.py          # Moved from tests/
dingo_waveform/cli.py                 # New CLI tool
examples/config_uniform.json          # Example config
examples/config_multibanded.json      # Example config
examples/README.md                    # User guide
CLI_TOOL_SUMMARY.md                   # This file
```

### Modified Files
```
pyproject.toml                        # Added entry point
tests/test_mfd_decimation.py          # Updated import
tests/test_dingo_compatibility.py     # Updated imports
```

### Removed Files
```
tests/utils_comparison.py             # Moved to package
```

---

## Command-Line Options

```
usage: dingo-verify [-h] [--config CONFIG] [--verbose] [--seed SEED]

Verify dingo-waveform against dingo (dingo-gw)

options:
  -h, --help            Show help message
  --config CONFIG, -c   Path to JSON configuration file (default: config.json)
  --verbose, -v         Display detailed comparison output
  --seed SEED, -s       Random seed for parameter sampling
```

---

## Exit Codes

- **0**: Verification passed (differences < 1e-15)
- **1**: Verification failed or shape mismatch

Scripts can use these exit codes for automated testing:

```bash
if dingo-verify --config config.json; then
    echo "Verification passed!"
else
    echo "Verification failed!"
    exit 1
fi
```

---

## Supported Configurations

### Domain Types
1. **UniformFrequencyDomain**
   - Required: `delta_f`, `f_min`, `f_max`
   - Example: `examples/config_uniform.json`

2. **MultibandedFrequencyDomain**
   - Required: `nodes`, `delta_f_initial`, `base_delta_f`
   - Example: `examples/config_multibanded.json`

### Approximants
- **LAL**: IMRPhenomD, IMRPhenomXAS, IMRPhenomXPHM
- **Time-domain**: SEOBNRv4PHM, SEOBNRv5PHM, SEOBNRv5HM

---

## Benefits for Users

### 1. Easy Verification
Users can quickly verify that dingo-waveform works correctly:
```bash
dingo-verify --config my_config.json
```

### 2. Scientific Confidence
Clear output shows exact numerical differences at machine precision level.

### 3. Debugging Aid
If something goes wrong, the tool pinpoints the issue:
- Shape mismatches
- Numerical discrepancies
- Configuration errors

### 4. Integration Testing
Can be used in CI/CD pipelines:
```bash
# In GitHub Actions, GitLab CI, etc.
dingo-verify --config test_config.json || exit 1
```

### 5. Documentation
Comprehensive help text and examples guide users through the process.

---

## Test Results

### UniformFrequencyDomain
```bash
./venv/bin/dingo-verify --config examples/config_uniform.json
```
**Result:** ✅ PASSED - Exact match (0.00e+00 difference)

### MultibandedFrequencyDomain
```bash
./venv/bin/dingo-verify --config examples/config_multibanded.json
```
**Result:** ✅ PASSED - Machine precision match (1.97e-24 difference)

---

## Future Enhancements (Optional)

1. **Multiple waveforms**: Test with random parameter sampling
2. **Plotting**: Generate comparison plots with matplotlib
3. **Batch mode**: Test multiple configurations at once
4. **Report generation**: HTML/PDF reports with detailed analysis
5. **Performance comparison**: Timing benchmarks

---

## Conclusion

The `dingo-verify` tool provides:
- ✅ Simple command-line interface
- ✅ JSON configuration support
- ✅ Clear, visual output
- ✅ Proper error handling
- ✅ Comprehensive documentation
- ✅ Example configurations
- ✅ Tested and working

Users can now easily verify that dingo-waveform produces identical results to dingo (dingo-gw), building confidence in the refactored package.

---

**Date:** 2025-11-07
**Status:** ✅ Complete and Tested
